/*
 bootstrap-fileinput v4.3.12
 http://plugins.krajee.com/file-input

 Author: Kartik Visweswaran
 Copyright: 2014 - 2016, Kartik Visweswaran, Krajee.com

 Licensed under the BSD 3-Clause
 https://github.com/kartik-v/bootstrap-fileinput/blob/master/LICENSE.md
*/
(function(f){"function"===typeof define&&define.amd?define(["jquery"],f):"object"===typeof module&&module.exports?module.exports=f(require("jquery")):f(window.jQuery)})(function(f){f.fn.fileinputLocales={};f.fn.fileinputThemes={};var O,r,B,q,m,T,I,aa,ba,v,ca,U,V,P,E,W,J,k,F,y,Q,X,G,R,da,S,Y,Z,C;O=window.URL||window.webkitURL;r=function(a,b,c){return void 0!==a&&(c?a===b:a.match(b))};B=function(a){if("Microsoft Internet Explorer"!==navigator.appName)return!1;if(10===a)return(new RegExp("msie\\s"+a,
"i")).test(navigator.userAgent);var b=document.createElement("div");b.innerHTML="\x3c!--[if IE "+a+"]> <i></i> <![endif]--\x3e";a=b.getElementsByTagName("i").length;document.body.appendChild(b);b.parentNode.removeChild(b);return a};q=function(a,b,c,d){b=d?b:b.split(" ").join(".fileinput ")+".fileinput";a.off(b).on(b,c)};m={data:{},init:function(a){var b=a.initialPreview,c=a.id;0<b.length&&!F(b)&&(b=b.split(a.initialPreviewDelimiter));m.data[c]={content:b,config:a.initialPreviewConfig,tags:a.initialPreviewThumbTags,
delimiter:a.initialPreviewDelimiter,previewFileType:a.initialPreviewFileType,previewAsData:a.initialPreviewAsData,template:a.previewGenericTemplate,showZoom:a.fileActionSettings.showZoom,showDrag:a.fileActionSettings.showDrag,getSize:function(b){return a._getSize(b)},parseTemplate:function(b,c,g,h,f,n,p){return a._generatePreviewTemplate(b,c,g,h,f,!1,null," file-preview-initial",n,p)},msg:function(b){return a._getMsgSelected(b)},initId:a.previewInitId,footer:a._getLayoutTemplate("footer").replace(/\{progress}/g,
a._renderThumbProgress()),isDelete:a.initialPreviewShowDelete,caption:a.initialCaption,actions:function(b,c,g,h,f,n,p){return a._renderFileActions(b,c,g,h,f,n,p,!0)}}},fetch:function(a){return m.data[a].content.filter(function(a){return null!==a})},count:function(a,b){return m.data[a]&&m.data[a].content?b?m.data[a].content.length:m.fetch(a).length:0},get:function(a,b,c){var d="init_"+b,e=m.data[a],g=e.config[b],h=e.content[b],l=e.initId+"-"+d,n=" file-preview-initial",p;p=y("previewAsData",g,e.previewAsData);
c=void 0===c?!0:c;if(!h)return"";g&&g.frameClass&&(n+=" "+g.frameClass);p?(n=e.previewAsData?y("type",g,e.previewFileType||"generic"):"generic",p=y("caption",g),a=m.footer(a,b,c,g&&g.size||null),c=y("filetype",g,n),d=e.parseTemplate(n,h,p,c,l,a,d,null)):d=e.template.replace(/\{previewId}/g,l).replace(/\{frameClass}/g,n).replace(/\{fileindex}/g,d).replace(/\{content}/g,e.content[b]).replace(/\{template}/g,y("type",g,e.previewFileType)).replace(/\{footer}/g,m.footer(a,b,c,g&&g.size||null));e.tags.length&&
e.tags[b]&&(d=G(d,e.tags[b]));k(g)||k(g.frameAttr)||(b=f(document.createElement("div")).html(d),b.find(".file-preview-initial").attr(g.frameAttr),d=b.html(),b.remove());return d},add:function(a,b,c,d,e){var g=f.extend(!0,{},m.data[a]);F(b)||(b=b.split(g.delimiter));e?(e=g.content.push(b)-1,g.config[e]=c,g.tags[e]=d):(e=b.length-1,g.content=b,g.config=c,g.tags=d);m.data[a]=g;return e},set:function(a,b,c,d,e){var g=f.extend(!0,{},m.data[a]);if(b&&b.length&&(F(b)||(b=b.split(g.delimiter)),b.filter(function(a){return null!==
a}).length)){void 0===g.content&&(g.content=[]);void 0===g.config&&(g.config=[]);void 0===g.tags&&(g.tags=[]);if(e){for(e=0;e<b.length;e++)b[e]&&g.content.push(b[e]);for(e=0;e<c.length;e++)c[e]&&g.config.push(c[e]);for(e=0;e<d.length;e++)d[e]&&g.tags.push(d[e])}else g.content=b,g.config=c,g.tags=d;m.data[a]=g}},unset:function(a,b){var c=m.count(a.id);c&&(1===c?(m.data[a.id].content=[],m.data[a.id].config=[],m.data[a.id].tags=[],a.initialPreview=[],a.initialPreviewConfig=[],a.initialPreviewThumbTags=
[]):(m.data[a.id].content[b]=null,m.data[a.id].config[b]=null,m.data[a.id].tags[b]=null))},out:function(a){var b="",c=m.data[a],d=m.count(a,!0);if(0===d)return{content:"",caption:""};for(var e=0;e<d;e++)b+=m.get(a,e);a=c.msg(m.count(a));return{content:'<div class="file-initial-thumbs">'+b+"</div>",caption:a}},footer:function(a,b,c,d){a=m.data[a];c=void 0===c?!0:c;if(0===a.config.length||k(a.config[b]))return"";var e=a.config[b];b=y("caption",e);var g=y("width",e,"auto"),h=y("url",e,!1),f=y("key",
e,null),n=y("showDelete",e,!0),p=y("showZoom",e,a.showZoom),e=y("showDrag",e,a.showDrag);c=a.isDelete?a.actions(!1,n,p,e,!1===h&&c,h,f):"";return a.footer.replace(/\{actions}/g,c).replace(/\{caption}/g,b).replace(/\{size}/g,a.getSize(d)).replace(/\{width}/g,g).replace(/\{indicator}/g,"").replace(/\{indicatorTitle}/g,"")}};T=function(a,b){b=b||0;if("number"===typeof a)return a;"string"===typeof a&&(a=parseFloat(a));return isNaN(a)?b:a};I=function(){return!(!window.File||!window.FileReader)};aa=function(){var a=
document.createElement("div");return!B(9)&&(void 0!==a.draggable||void 0!==a.ondragstart&&void 0!==a.ondrop)};ba=function(){return I()&&window.FormData};v=function(a,b){a.removeClass(b).addClass(b)};ca={showRemove:!0,showUpload:!0,showZoom:!0,showDrag:!0,removeIcon:'<i class="glyphicon glyphicon-trash text-danger"></i>',removeClass:"btn btn-xs btn-default",removeTitle:"Remove file",uploadIcon:'<i class="glyphicon glyphicon-upload text-info"></i>',uploadClass:"btn btn-xs btn-default",uploadTitle:"Upload file",
zoomIcon:'<i class="glyphicon glyphicon-zoom-in"></i>',zoomClass:"btn btn-xs btn-default",zoomTitle:"View Details",dragIcon:'<i class="glyphicon glyphicon-menu-hamburger"></i>',dragClass:"text-info",dragTitle:"Move / Rearrange",dragSettings:{},indicatorNew:'<i class="glyphicon glyphicon-hand-down text-warning"></i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign text-success"></i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"></i>',indicatorLoading:'<i class="glyphicon glyphicon-hand-up text-muted"></i>',
indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ..."};U={main1:'{preview}\n<div class="kv-upload-progress hide"></div>\n<div class="input-group {class}">\n   {caption}\n   <div class="input-group-btn">\n       {remove}\n       {cancel}\n       {upload}\n       {browse}\n   </div>\n</div>',main2:'{preview}\n<div class="kv-upload-progress hide"></div>\n{remove}\n{cancel}\n{upload}\n{browse}\n',preview:'<div class="file-preview {class}">\n    {close}    <div class="{dropClass}">\n    <div class="file-preview-thumbnails">\n    </div>\n    <div class="clearfix"></div>    <div class="file-preview-status text-center text-success"></div>\n    <div class="kv-fileinput-error"></div>\n    </div>\n</div>',
close:'<div class="close fileinput-remove">&times;</div>\n',fileIcon:'<i class="glyphicon glyphicon-file kv-caption-icon"></i>',caption:'<div tabindex="500" class="form-control file-caption {class}">\n   <div class="file-caption-name"></div>\n</div>\n',modalMain:'<div id="kvFileinputModal" class="file-zoom-dialog modal fade" tabindex="-1" aria-labelledby="kvFileinputModalLabel"></div>',modal:'<div class="modal-dialog modal-lg" role="document">\n  <div class="modal-content">\n    <div class="modal-header">\n      <div class="kv-zoom-actions pull-right">{toggleheader}{fullscreen}{borderless}{close}</div>\n      <h3 class="modal-title">{heading} <small><span class="kv-zoom-title"></span></small></h3>\n    </div>\n    <div class="modal-body">\n      <div class="floating-buttons"></div>\n      <div class="kv-zoom-body file-zoom-content"></div>\n{prev} {next}\n    </div>\n  </div>\n</div>\n',
progress:'<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {percent}%\n     </div>\n</div>',size:" <br><samp>({sizeText})</samp>",footer:'<div class="file-thumbnail-footer">\n    <div class="file-footer-caption" title="{caption}">{caption}{size}</div>\n    {progress} {actions}\n</div>',actions:'<div class="file-actions">\n    <div class="file-footer-buttons">\n        {upload} {delete} {zoom} {other}    </div>\n    {drag}\n    <div class="file-upload-indicator" title="{indicatorTitle}">{indicator}</div>\n    <div class="clearfix"></div>\n</div>',
actionDelete:'<button type="button" class="kv-file-remove {removeClass}" title="{removeTitle}" {dataUrl}{dataKey}>{removeIcon}</button>\n',actionUpload:'<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">{uploadIcon}</button>',actionZoom:'<button type="button" class="kv-file-zoom {zoomClass}" title="{zoomTitle}">{zoomIcon}</button>',actionDrag:'<span class="file-drag-handle {dragClass}" title="{dragTitle}">{dragIcon}</span>',btnDefault:'<button type="{type}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}</button>',
btnLink:'<a href="{href}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}</a>',btnBrowse:'<div tabindex="500" class="{css}" {status}>{icon} {label}</div>'};V={generic:'<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}"><div class="kv-file-content">\n{content}\n</div>{footer}\n</div>\n',html:'<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}"><div class="kv-file-content">\n<div class="kv-preview-data file-preview-html" title="{caption}" style="width:{width};height:{height};">{data}</div>\n</div>{footer}\n</div>\n',
image:'<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}"><div class="kv-file-content">\n<img src="{data}" class="kv-preview-data file-preview-image" title="{caption}" alt="{caption}" style="width:{width};height:{height};">\n</div>{footer}\n</div>\n',text:'<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}"><div class="kv-file-content">\n<textarea class="kv-preview-data file-preview-text" title="{caption}" readonly style="width:{width};height:{height};">{data}</textarea>\n</div>{footer}\n</div>\n',
video:'<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}" title="{caption}" style="width:{width};height:{height};"><div class="kv-file-content">\n<video class="kv-preview-data" width="{width}" height="{height}" controls>\n<source src="{data}" type="{type}">\n<div class="file-preview-other">\n<span class="{previewFileIconClass}">{previewFileIcon}</span>\n</div>\n</video>\n</div>{footer}\n</div>\n',audio:'<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}" title="{caption}" style="width:{width};height:{height};"><div class="kv-file-content">\n<audio class="kv-preview-data" controls>\n<source src="{data}" type="{type}">\n<div class="file-preview-other">\n<span class="{previewFileIconClass}">{previewFileIcon}</span>\n</div>\n</audio>\n</div>{footer}\n</div>\n',
flash:'<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}" title="{caption}" style="width:{width};height:{height};"><div class="kv-file-content">\n<object class="kv-preview-data file-object" type="application/x-shockwave-flash" width="{width}" height="{height}" data="{data}">\n<param name="controller" value="true" />\n<param name="allowFullScreen" value="true" />\n<param name="allowScriptAccess" value="always" />\n<param name="autoPlay" value="false" />\n<param name="autoStart" value="false" />\n<param name="quality" value="high" />\n <div class="file-preview-other">\n<span class="{previewFileIconClass}">{previewFileIcon}</span>\n</div>\n</object>\n</div>{footer}\n</div>\n',
object:'<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}" title="{caption}" style="width:{width};height:{height};"><div class="kv-file-content">\n<object class="kv-preview-data file-object" data="{data}" type="{type}" width="{width}" height="{height}">\n<param name="movie" value="{caption}" />\n<param name="controller" value="true" />\n<param name="allowFullScreen" value="true" />\n<param name="allowScriptAccess" value="always" />\n<param name="autoPlay" value="false" />\n<param name="autoStart" value="false" />\n<param name="quality" value="high" />\n <div class="file-preview-other">\n<span class="{previewFileIconClass}">{previewFileIcon}</span>\n</div>\n</object>\n</div>{footer}\n</div>\n',
pdf:'<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}" title="{caption}" style="width:{width};height:{height};"><div class="kv-file-content">\n<embed class="kv-preview-data" src="{data}" width="{width}" height="{height}" type="application/pdf">\n</div>{footer}\n</div>\n',other:'<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}" title="{caption}" style="width:{width};height:{height};"><div class="kv-file-content">\n<div class="kv-preview-data file-preview-other-frame">\n<div class="file-preview-other">\n<span class="{previewFileIconClass}">{previewFileIcon}</span>\n</div>\n</div>\n</div>{footer}\n</div>\n'};
P="image html text video audio flash pdf object".split(" ");W={image:{width:"auto",height:"160px"},html:{width:"213px",height:"160px"},text:{width:"213px",height:"160px"},video:{width:"213px",height:"160px"},audio:{width:"213px",height:"80px"},flash:{width:"213px",height:"160px"},object:{width:"160px",height:"160px"},pdf:{width:"160px",height:"160px"},other:{width:"160px",height:"160px"}};J={image:function(a,b){return r(a,"image.*")||r(b,/\.(gif|png|jpe?g)$/i)},html:function(a,b){return r(a,"text/html")||
r(b,/\.(htm|html)$/i)},text:function(a,b){return r(a,"text.*")||r(b,/\.(xml|javascript)$/i)||r(b,/\.(txt|md|csv|nfo|ini|json|php|js|css)$/i)},video:function(a,b){return r(a,"video.*")&&(r(a,/(ogg|mp4|mp?g|webm|3gp)$/i)||r(b,/\.(og?|mp4|webm|mp?g|3gp)$/i))},audio:function(a,b){return r(a,"audio.*")&&(r(b,/(ogg|mp3|mp?g|wav)$/i)||r(b,/\.(og?|mp3|mp?g|wav)$/i))},flash:function(a,b){return r(a,"application/x-shockwave-flash",!0)||r(b,/\.(swf)$/i)},pdf:function(a,b){return r(a,"application/pdf",!0)||r(b,
/\.(pdf)$/i)},object:function(){return!0},other:function(){return!0}};k=function(a,b){return void 0===a||null===a||0===a.length||b&&""===f.trim(a)};F=function(a){return Array.isArray(a)||"[object Array]"===Object.prototype.toString.call(a)};y=function(a,b,c){return b&&"object"===typeof b&&a in b?b[a]:c||""};E=function(a,b,c){return k(a)||k(a[b])?c:f(a[b])};Q=function(){return Math.round((new Date).getTime()+100*Math.random())};X=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,
"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")};G=function(a,b){var c=a;if(!b)return c;f.each(b,function(a,b){"function"===typeof b&&(b=b());c=c.split(a).join(b)});return c};R=function(a){a=a.is("img")?a.attr("src"):a.find("source").attr("src");O.revokeObjectURL(a)};da=function(a){var b=a.lastIndexOf("/");-1===b&&(b=a.lastIndexOf("\\"));return a.split(a.substring(b,b+1)).pop()};S=function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||
document.msFullscreenElement};Y=function(a){a&&!S()?document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):document.exitFullscreen?document.exitFullscreen():
document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()};Z=function(a,b,c){if(c>=a.length)for(var d=c-a.length;d--+1;)a.push(void 0);a.splice(c,0,a.splice(b,1)[0]);return a};C=function(a,b){this.$element=f(a);this._validate()&&(this.isPreviewable=I(),this.isIE9=B(9),this.isIE10=B(10),this.isPreviewable||this.isIE9?(this._init(b),this._listen()):this.$element.removeClass("file-loading"))};
C.prototype={constructor:C,_init:function(a){var b=this,c=b.$element;f.each(a,function(a,c){switch(a){case "minFileCount":case "maxFileCount":case "maxFileSize":b[a]=T(c);break;default:b[a]=c}});b.fileInputCleared=!1;b.fileBatchCompleted=!0;b.isPreviewable||(b.showPreview=!1);b.uploadFileAttr=k(c.attr("name"))?"file_data":c.attr("name");b.reader=null;b.formdata={};b.clearStack();b.uploadCount=0;b.uploadStatus={};b.uploadLog=[];b.uploadAsyncCount=0;b.loadedImages=[];b.totalImagesCount=0;b.ajaxRequests=
[];b.isError=!1;b.ajaxAborted=!1;b.cancelling=!1;c=b._getLayoutTemplate("progress");b.progressTemplate=c.replace("{class}",b.progressClass);b.progressCompleteTemplate=c.replace("{class}",b.progressCompleteClass);b.progressErrorTemplate=c.replace("{class}",b.progressErrorClass);b.dropZoneEnabled=aa()&&b.dropZoneEnabled;b.isDisabled=b.$element.attr("disabled")||b.$element.attr("readonly");b.isUploadable=ba()&&!k(b.uploadUrl);b.isClickable=b.browseOnZoneClick&&b.showPreview&&(b.isUploadable&&b.dropZoneEnabled||
!k(b.defaultPreviewContent));b.slug="function"===typeof a.slugCallback?a.slugCallback:b._slugDefault;b.mainTemplate=b.showCaption?b._getLayoutTemplate("main1"):b._getLayoutTemplate("main2");b.captionTemplate=b._getLayoutTemplate("caption");b.previewGenericTemplate=b._getPreviewTemplate("generic");b.resizeImage&&(b.maxImageWidth||b.maxImageHeight)&&(b.imageCanvas=document.createElement("canvas"),b.imageCanvasContext=b.imageCanvas.getContext("2d"));k(b.$element.attr("id"))&&b.$element.attr("id",Q());
void 0===b.$container?b.$container=b._createContainer():b._refreshContainer();b.$dropZone=b.$container.find(".file-drop-zone");b.$progress=b.$container.find(".kv-upload-progress");b.$btnUpload=b.$container.find(".fileinput-upload");b.$captionContainer=E(a,"elCaptionContainer",b.$container.find(".file-caption"));b.$caption=E(a,"elCaptionText",b.$container.find(".file-caption-name"));b.$previewContainer=E(a,"elPreviewContainer",b.$container.find(".file-preview"));b.$preview=E(a,"elPreviewImage",b.$container.find(".file-preview-thumbnails"));
b.$previewStatus=E(a,"elPreviewStatus",b.$container.find(".file-preview-status"));b.$errorContainer=E(a,"elErrorContainer",b.$previewContainer.find(".kv-fileinput-error"));k(b.msgErrorClass)||v(b.$errorContainer,b.msgErrorClass);b.$errorContainer.hide();b.fileActionSettings=f.extend(!0,ca,a.fileActionSettings);b.previewInitId="preview-"+Q();b.id=b.$element.attr("id");m.init(b);b._initPreview(!0);b._initPreviewActions();b.options=a;b._setFileDropZoneTitle();b.$element.removeClass("file-loading");b.$element.attr("disabled")&&
b.disable();b._initZoom()},_validate:function(){if("file"===this.$element.attr("type"))return!0;this.$element.after('<div class="help-block alert alert-warning"><h4>Invalid Input Type</h4>You must set an input <code>type = file</code> for <b>bootstrap-fileinput</b> plugin to initialize.</div>');return!1},_errorsExist:function(){var a;if(this.$errorContainer.find("li").length)return!0;a=f(document.createElement("div")).html(this.$errorContainer.html());a.find("span.kv-error-close").remove();a.find("ul").remove();
return f.trim(a.text()).length?!0:!1},_errorHandler:function(a,b){var c=a.target.error;c.code===c.NOT_FOUND_ERR?this._showError(this.msgFileNotFound.replace("{name}",b)):c.code===c.SECURITY_ERR?this._showError(this.msgFileSecured.replace("{name}",b)):c.code===c.NOT_READABLE_ERR?this._showError(this.msgFileNotReadable.replace("{name}",b)):c.code===c.ABORT_ERR?this._showError(this.msgFilePreviewAborted.replace("{name}",b)):this._showError(this.msgFilePreviewError.replace("{name}",b))},_addError:function(a){var b=
this.$errorContainer;a&&b.length&&(b.html(this.errorCloseButton+a),q(b.find(".kv-error-close"),"click",function(){b.fadeOut("slow")}))},_resetErrors:function(a){var b=this.$errorContainer;this.isError=!1;this.$container.removeClass("has-error");b.html("");a?b.fadeOut("slow"):b.hide()},_showFolderError:function(a){var b=this.$errorContainer,c;a&&(c=this.msgFoldersNotAllowed.replace(/\{n}/g,a),this._addError(c),v(this.$container,"has-error"),b.fadeIn(800),this._raise("filefoldererror",[a,c]))},_showUploadError:function(a,
b,c){var d=this.$errorContainer;c=c||"fileuploaderror";var e=b&&b.id?'<li data-file-id="'+b.id+'">'+a+"</li>":"<li>"+a+"</li>";0===d.find("ul").length?this._addError("<ul>"+e+"</ul>"):d.find("ul").append(e);d.fadeIn(800);this._raise(c,[b,a]);this.$container.removeClass("file-input-new");v(this.$container,"has-error");return!0},_showError:function(a,b,c){var d=this.$errorContainer;c=c||"fileerror";b=b||{};b.reader=this.reader;this._addError(a);d.fadeIn(800);this._raise(c,[b,a]);this.isUploadable||
this._clearFileInput();this.$container.removeClass("file-input-new");v(this.$container,"has-error");this.$btnUpload.attr("disabled",!0);return!0},_noFilesError:function(a){var b=1<this.minFileCount?this.filePlural:this.fileSingle,b=this.msgFilesTooLess.replace("{n}",this.minFileCount).replace("{files}",b),c=this.$errorContainer;this._addError(b);this.isError=!0;this._updateFileDetails(0);c.fadeIn(800);this._raise("fileerror",[a,b]);this._clearFileInput();v(this.$container,"has-error")},_parseError:function(a,
b,c){b=f.trim(b+"");var d="."===b.slice(-1)?"":".";a=void 0!==a.responseJSON&&void 0!==a.responseJSON.error?a.responseJSON.error:a.responseText;this.cancelling&&this.msgUploadAborted&&(b=this.msgUploadAborted);this.showAjaxErrorDetails&&a?(a=f.trim(a.replace(/\n\s*\n/g,"\n")),a=0<a.length?"<pre>"+a+"</pre>":"",b+=d+a):b+=d;this.cancelling=!1;return c?"<b>"+c+": </b>"+b:b},_parseFileType:function(a){var b,c,d;for(d=0;d<P.length;d+=1)if(c=P[d],b=y(c,this.fileTypeSettings,J[c]),b=b(a.type,a.name)?c:
"",!k(b))return b;return"other"},_parseFilePreviewIcon:function(a,b){var c=this,d,e=c.previewFileIcon;b&&-1<b.indexOf(".")&&(d=b.split(".").pop(),c.previewFileIconSettings&&c.previewFileIconSettings[d]&&(e=c.previewFileIconSettings[d]),c.previewFileExtSettings&&f.each(c.previewFileExtSettings,function(a,b){c.previewFileIconSettings[a]&&b(d)&&(e=c.previewFileIconSettings[a])}));return-1<a.indexOf("{previewFileIcon}")?a.replace(/\{previewFileIconClass}/g,c.previewFileIconClass).replace(/\{previewFileIcon}/g,
e):a},_raise:function(a,b){var c=f.Event(a);void 0!==b?this.$element.trigger(c,b):this.$element.trigger(c);if(c.isDefaultPrevented())return!1;if(!c.result)return c.result;switch(a){case "filebatchuploadcomplete":case "filebatchuploadsuccess":case "fileuploaded":case "fileclear":case "filecleared":case "filereset":case "fileerror":case "filefoldererror":case "fileuploaderror":case "filebatchuploaderror":case "filedeleteerror":case "filecustomerror":case "filesuccessremove":break;default:this.ajaxAborted=
c.result}return!0},_listenFullScreen:function(a){var b=this.$modal,c,d;b&&b.length&&(c=b&&b.find(".btn-fullscreen"),d=b&&b.find(".btn-borderless"),c.length&&d.length&&(c.removeClass("active").attr("aria-pressed","false"),d.removeClass("active").attr("aria-pressed","false"),a?c.addClass("active").attr("aria-pressed","true"):d.addClass("active").attr("aria-pressed","true"),b.hasClass("file-zoom-fullscreen")?this._maximizeZoomDialog():a?this._maximizeZoomDialog():d.removeClass("active").attr("aria-pressed",
"false")))},_listen:function(){var a=this,b=a.$element,c=b.closest("form"),d=a.$container;q(b,"change",f.proxy(a._change,a));a.showBrowse&&q(a.$btnFile,"click",f.proxy(a._browse,a));q(c,"reset",f.proxy(a.reset,a));q(d.find(".fileinput-remove:not([disabled])"),"click",f.proxy(a.clear,a));q(d.find(".fileinput-cancel"),"click",f.proxy(a.cancel,a));a._initDragDrop();a.isUploadable||q(c,"submit",f.proxy(a._submitForm,a));q(a.$container.find(".fileinput-upload"),"click",f.proxy(a._uploadClick,a));q(f(window),
"resize",function(){a._listenFullScreen(screen.width===window.innerWidth&&screen.height===window.innerHeight)});q(f(document),"webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",function(){a._listenFullScreen(S())});a._initClickable()},_initClickable:function(){var a=this,b;a.isClickable&&(b=a.isUploadable?a.$dropZone:a.$preview.find(".file-default-preview"),v(b,"clickable"),b.attr("tabindex",-1),q(b,"click",function(c){c=f(c.target);if(!c.parents(".file-preview-thumbnails").length||
c.parents(".file-default-preview").length)a.$element.trigger("click"),b.blur()}))},_initDragDrop:function(){var a=this.$dropZone;this.isUploadable&&this.dropZoneEnabled&&this.showPreview&&(q(a,"dragenter dragover",f.proxy(this._zoneDragEnter,this)),q(a,"dragleave",f.proxy(this._zoneDragLeave,this)),q(a,"drop",f.proxy(this._zoneDrop,this)),q(f(document),"dragenter dragover drop",this._zoneDragDropInit))},_zoneDragDropInit:function(a){a.stopPropagation();a.preventDefault()},_zoneDragEnter:function(a){var b=
-1<f.inArray("Files",a.originalEvent.dataTransfer.types);this._zoneDragDropInit(a);this.isDisabled||!b?(a.originalEvent.dataTransfer.effectAllowed="none",a.originalEvent.dataTransfer.dropEffect="none"):v(this.$dropZone,"file-highlighted")},_zoneDragLeave:function(a){this._zoneDragDropInit(a);this.isDisabled||this.$dropZone.removeClass("file-highlighted")},_zoneDrop:function(a){a.preventDefault();this.isDisabled||k(a.originalEvent.dataTransfer.files)||(this._change(a,"dragdrop"),this.$dropZone.removeClass("file-highlighted"))},
_uploadClick:function(a){var b=this.$container.find(".fileinput-upload"),c=!b.hasClass("disabled")&&k(b.attr("disabled"));a&&a.isDefaultPrevented()||(this.isUploadable?(a.preventDefault(),c&&this.upload()):c&&"submit"!==b.attr("type")&&(b=b.closest("form"),b.length&&b.trigger("submit"),a.preventDefault()))},_submitForm:function(){var a=this.$element.get(0).files;return a&&0<this.minFileCount&&this._getFileCount(a.length)<this.minFileCount?(this._noFilesError({}),!1):!this._abort({})},_clearPreview:function(){(this.showUploadedThumbs?
this.$preview.find(".file-preview-frame:not(.file-preview-success)"):this.$preview.find(".file-preview-frame")).remove();this.$preview.find(".file-preview-frame").length&&this.showPreview||this._resetUpload();this._validateDefaultPreview()},_initSortable:function(){var a=this,b,c;window.KvSortable&&(b=a.$preview.find(".file-initial-thumbs"),c={handle:".drag-handle-init",dataIdAttr:"data-preview-id",draggable:".file-preview-initial",onSort:function(b){var c=b.oldIndex,d=b.newIndex;a.initialPreview=
Z(a.initialPreview,c,d);a.initialPreviewConfig=Z(a.initialPreviewConfig,c,d);m.init(a);for(var h=0;h<a.initialPreviewConfig.length;h++)if(null!==a.initialPreviewConfig[h]){var l=f(".kv-file-remove[data-key='"+a.initialPreviewConfig[h].key+"']"),l=l.closest(".file-preview-frame");l.attr("data-fileindex","init_"+h);l.data("fileindex","init_"+h)}a._raise("filesorted",{previewId:f(b.item).attr("id"),oldIndex:c,newIndex:d,stack:a.initialPreviewConfig})}},b.data("kvsortable")&&b.kvsortable("destroy"),f.extend(!0,
c,a.fileActionSettings.dragSettings),b.kvsortable(c))},_initPreview:function(a){var b=this.initialCaption||"",c;m.count(this.id)?(c=m.out(this.id),b=a&&this.initialCaption?this.initialCaption:c.caption,this.$preview.html(c.content),this._setCaption(b),this._initSortable(),k(c.content)||this.$container.removeClass("file-input-new")):(this._clearPreview(),a?this._setCaption(b):this._initCaption())},_getZoomButton:function(a){var b=this.previewZoomButtonIcons[a],c=this.previewZoomButtonClasses[a],d=
' title="'+(this.previewZoomButtonTitles[a]||"")+'" '+("close"===a?' data-dismiss="modal" aria-hidden="true"':"");if("fullscreen"===a||"borderless"===a||"toggleheader"===a)d+=' data-toggle="button" aria-pressed="false" autocomplete="off"';return'<button type="button" class="'+c+" btn-"+a+'"'+d+">"+b+"</button>"},_getModalContent:function(){return this._getLayoutTemplate("modal").replace(/\{heading}/g,this.msgZoomModalHeading).replace(/\{prev}/g,this._getZoomButton("prev")).replace(/\{next}/g,this._getZoomButton("next")).replace(/\{toggleheader}/g,
this._getZoomButton("toggleheader")).replace(/\{fullscreen}/g,this._getZoomButton("fullscreen")).replace(/\{borderless}/g,this._getZoomButton("borderless")).replace(/\{close}/g,this._getZoomButton("close"))},_listenModalEvent:function(a){var b=this,c=b.$modal;c.on(a+".bs.modal",function(d){var e=c.find(".btn-fullscreen"),g=c.find(".btn-borderless");b._raise("filezoom"+a,{sourceEvent:d,previewId:c.data("previewId"),modal:c});"shown"===a&&(g.removeClass("active").attr("aria-pressed","false"),e.removeClass("active").attr("aria-pressed",
"false"),c.hasClass("file-zoom-fullscreen")&&(b._maximizeZoomDialog(),S()?e.addClass("active").attr("aria-pressed","true"):g.addClass("active").attr("aria-pressed","true")))})},_initZoom:function(){var a;a=this._getLayoutTemplate("modalMain");this.$modal=f("#kvFileinputModal");this.$modal&&this.$modal.length||(a=f(document.createElement("div")).html(a).insertAfter(this.$container),this.$modal=f("#kvFileinputModal").insertBefore(a),a.remove());this.$modal.html(this._getModalContent());this._listenModalEvent("show");
this._listenModalEvent("shown");this._listenModalEvent("hide");this._listenModalEvent("hidden");this._listenModalEvent("loaded")},_initZoomButtons:function(){var a=this.$modal.data("previewId")||"",b,c;c=this.$preview.find(".file-preview-frame").toArray();var d=c.length,e=this.$modal.find(".btn-prev"),g=this.$modal.find(".btn-next");d&&(b=f(c[0]),c=f(c[d-1]),e.removeAttr("disabled"),g.removeAttr("disabled"),b.length&&b.attr("id")===a&&e.attr("disabled",!0),c.length&&c.attr("id")===a&&g.attr("disabled",
!0))},_maximizeZoomDialog:function(){var a=this.$modal,b=a.find(".modal-header:visible"),c=a.find(".modal-footer:visible"),d=a.find(".modal-body"),e=f(window).height();a.addClass("file-zoom-fullscreen");b&&b.length&&(e-=b.outerHeight(!0));c&&c.length&&(e-=c.outerHeight(!0));d&&d.length&&(b=d.outerHeight(!0)-d.height(),e-=b);a.find(".kv-zoom-body").height(e)},_resizeZoomDialog:function(a){var b=this.$modal,c=b.find(".btn-fullscreen"),d=b.find(".btn-borderless");if(b.hasClass("file-zoom-fullscreen"))(Y(!1),
a)?c.hasClass("active")||(b.removeClass("file-zoom-fullscreen"),this._resizeZoomDialog(!0),d.hasClass("active")&&d.removeClass("active").attr("aria-pressed","false")):c.hasClass("active")?c.removeClass("active").attr("aria-pressed","false"):(b.removeClass("file-zoom-fullscreen"),this.$modal.find(".kv-zoom-body").css("height",this.zoomModalHeight));else{if(!a){this._maximizeZoomDialog();return}Y(!0)}b.focus()},_setZoomContent:function(a,b){var c=this,d,e,g,h,l,n=a.attr("id"),p=c.$modal,u=p.find(".btn-prev"),
k=p.find(".btn-next"),m,t=p.find(".btn-fullscreen"),N=p.find(".btn-borderless"),ea=p.find(".btn-toggleheader");e=a.data("template")||"generic";d=a.find(".kv-file-content");d=d.length?d.html():"";g=a.find(".file-footer-caption").text()||"";p.find(".kv-zoom-title").html(g);h=p.find(".kv-zoom-body");b?(m=h.clone().insertAfter(h),h.html(d).hide(),m.fadeOut("fast",function(){h.fadeIn("fast");m.remove()})):h.html(d);if(e=c.previewZoomSettings[e])l=h.find(".kv-preview-data"),v(l,"file-zoom-detail"),f.each(e,
function(a,b){l.css(a,b);(l.attr("width")&&"width"===a||l.attr("height")&&"height"===a)&&l.removeAttr(a)});p.data("previewId",n);q(u,"click",function(){c._zoomSlideShow("prev",n)});q(k,"click",function(){c._zoomSlideShow("next",n)});q(t,"click",function(){c._resizeZoomDialog(!0)});q(N,"click",function(){c._resizeZoomDialog(!1)});q(ea,"click",function(){var a=p.find(".modal-header"),b=p.find(".modal-body .floating-buttons"),d,e=a.find(".kv-zoom-actions"),g=function(b){var d=c.$modal.find(".kv-zoom-body"),
e=c.zoomModalHeight;p.hasClass("file-zoom-fullscreen")&&(e=d.outerHeight(!0),b||(e-=a.outerHeight(!0)));d.css("height",b?e+b:e)};a.is(":visible")?(d=a.outerHeight(!0),a.slideUp("slow",function(){e.find(".btn").appendTo(b);g(d)})):(b.find(".btn").appendTo(e),a.slideDown("slow",function(){g()}));p.focus()});q(p,"keydown",function(a){a=a.which||a.keyCode;37!==a||u.attr("disabled")||c._zoomSlideShow("prev",n);39!==a||k.attr("disabled")||c._zoomSlideShow("next",n)})},_zoomPreview:function(a){if(!a.length)throw"Cannot zoom to detailed preview!";
this.$modal.html(this._getModalContent());a=a.closest(".file-preview-frame");this._setZoomContent(a);this.$modal.modal("show");this._initZoomButtons()},_zoomSlideShow:function(a,b){var c=this.$modal.find(".kv-zoom-actions .btn-"+a),d;d=this.$preview.find(".file-preview-frame").toArray();var e=d.length,g;if(!c.attr("disabled")){for(c=0;c<e;c++)if(f(d[c]).attr("id")===b){g="prev"===a?c-1:c+1;break}0>g||g>=e||!d[g]||(d=f(d[g]),d.length&&this._setZoomContent(d,!0),this._initZoomButtons(),this._raise("filezoom"+
a,{previewId:b,modal:this.$modal}))}},_initZoomButton:function(){var a=this;a.$preview.find(".kv-file-zoom").each(function(){var b=f(this);q(b,"click",function(){a._zoomPreview(b)})})},_initPreviewActions:function(){var a=this,b=a.deleteExtraData||{},c=function(){var b=a.isUploadable?m.count(a.id):a.$element.get(0).files.length;0!==a.$preview.find(".kv-file-remove").length||b||(a.reset(),a.initialCaption="")};a._initZoomButton();a.$preview.find(".kv-file-remove").each(function(){var d=f(this),e=d.data("url")||
a.deleteUrl,g=d.data("key");if(!k(e)&&void 0!==g){var h=d.closest(".file-preview-frame"),l=m.data[a.id],n,p,u=h.data("fileindex"),x,u=parseInt(u.replace("init_","")),l=k(l.config)&&k(l.config[u])?null:l.config[u];x=k(l)||k(l.extra)?b:l.extra;"function"===typeof x&&(x=x());p={id:d.attr("id"),key:g,extra:x};n=f.extend(!0,{},{url:e,type:"POST",dataType:"json",data:f.extend(!0,{},{key:g},x),beforeSend:function(b){a.ajaxAborted=!1;a._raise("filepredelete",[g,b,x]);a.ajaxAborted?b.abort():(v(h,"file-uploading"),
v(d,"disabled"))},success:function(b,e,f){var l;k(b)||k(b.error)?(m.init(a),u=parseInt(h.data("fileindex").replace("init_","")),m.unset(a,u),l=m.count(a.id),b=0<l?a._getMsgSelected(l):"",a._raise("filedeleted",[g,f,x]),a._setCaption(b),h.removeClass("file-uploading").addClass("file-deleted"),h.fadeOut("slow",function(){a._clearObjects(h);h.remove();c();l||0!==a.getFileStack().length||(a._setCaption(""),a.reset())})):(p.jqXHR=f,p.response=b,a._showError(b.error,p,"filedeleteerror"),h.removeClass("file-uploading"),
d.removeClass("disabled"),c())},error:function(b,d,e){d=a._parseError(b,e);p.jqXHR=b;p.response={};a._showError(d,p,"filedeleteerror");h.removeClass("file-uploading");c()}},a.ajaxDeleteSettings);q(d,"click",function(){if(!a._validateMinCount())return!1;f.ajax(n)})}})},_clearObjects:function(a){a.find("video audio").each(function(){this.pause();f(this).remove()});a.find("img object div").each(function(){f(this).remove()})},_clearFileInput:function(){var a=this.$element,b,c,d;this.fileInputCleared=
!0;k(a.val())||(this.isIE9||this.isIE10?(b=a.closest("form"),c=f(document.createElement("form")),d=f(document.createElement("div")),a.before(d),b.length?b.after(c):d.after(c),c.append(a).trigger("reset"),d.before(a).remove(),c.remove()):a.val(""))},_resetUpload:function(){this.uploadCache={content:[],config:[],tags:[],append:!0};this.uploadCount=0;this.uploadStatus={};this.uploadLog=[];this.uploadAsyncCount=0;this.loadedImages=[];this.totalImagesCount=0;this.$btnUpload.removeAttr("disabled");this._setProgress(0);
v(this.$progress,"hide");this._resetErrors(!1);this.ajaxAborted=!1;this.ajaxRequests=[];this._resetCanvas()},_resetCanvas:function(){this.canvas&&this.imageCanvasContext&&this.imageCanvasContext.clearRect(0,0,this.canvas.width,this.canvas.height)},_hasInitialPreview:function(){return!this.overwriteInitial&&m.count(this.id)},_resetPreview:function(){var a;m.count(this.id)?(a=m.out(this.id),this.$preview.html(a.content),a=this.initialCaption?this.initialCaption:a.caption,this._setCaption(a)):(this._clearPreview(),
this._initCaption());this.showPreview&&(this._initZoom(),this._initSortable())},_clearDefaultPreview:function(){this.$preview.find(".file-default-preview").remove()},_validateDefaultPreview:function(){this.showPreview&&!k(this.defaultPreviewContent)&&(this.$preview.html('<div class="file-default-preview">'+this.defaultPreviewContent+"</div>"),this.$container.removeClass("file-input-new"),this._initClickable())},_resetPreviewThumbs:function(a){a?(this._clearPreview(),this.clearStack()):this._hasInitialPreview()?
(a=m.out(this.id),this.$preview.html(a.content),this._setCaption(a.caption),this._initPreviewActions()):this._clearPreview()},_getLayoutTemplate:function(a){a=y(a,this.layoutTemplates,U[a]);return k(this.customLayoutTags)?a:G(a,this.customLayoutTags)},_getPreviewTemplate:function(a){a=y(a,this.previewTemplates,V[a]);return k(this.customPreviewTags)?a:G(a,this.customPreviewTags)},_getOutData:function(a,b,c){a=a||{};b=b||{};c=c||this.filestack.slice(0)||{};return{form:this.formdata,files:c,filenames:this.filenames,
filescount:this.getFilesCount(),extra:this._getExtraData(),response:b,reader:this.reader,jqXHR:a}},_getMsgSelected:function(a){var b=1===a?this.fileSingle:this.filePlural;return 0<a?this.msgSelected.replace("{n}",a).replace("{files}",b):this.msgNoFilesSelected},_getThumbs:function(a){return this.$preview.find(".file-preview-frame:not(.file-preview-initial)"+(a||""))},_getExtraData:function(a,b){var c=this.uploadExtraData;"function"===typeof this.uploadExtraData&&(c=this.uploadExtraData(a,b));return c},
_initXhr:function(a,b,c){var d=this;a.upload&&a.upload.addEventListener("progress",function(a){var e=0,h=a.total,f=a.loaded||a.position;a.lengthComputable&&(e=Math.floor(f/h*100));b?d._setAsyncUploadStatus(b,e,c):d._setProgress(e)},!1);return a},_ajaxSubmit:function(a,b,c,d,e,g){var h=this;h._raise("filepreajax",[e,g]);h._uploadExtra(e,g);a=f.extend(!0,{},{xhr:function(){var a=f.ajaxSettings.xhr();return h._initXhr(a,e,h.getFileStack().length)},url:h.uploadUrl,type:"POST",dataType:"json",data:h.formdata,
cache:!1,processData:!1,contentType:!1,beforeSend:a,success:b,complete:c,error:d},h.ajaxSettings);h.ajaxRequests.push(f.ajax(a))},_initUploadSuccess:function(a,b,c){var d=this,e,g,h,l,n=function(a,b){d[a]instanceof Array||(d[a]=[]);b&&b.length&&(d[a]=d[a].concat(b))};d.showPreview&&"object"===typeof a&&!f.isEmptyObject(a)&&void 0!==a.initialPreview&&0<a.initialPreview.length&&(d.hasInitData=!0,e=a.initialPreview||[],h=a.initialPreviewConfig||[],l=a.initialPreviewThumbTags||[],a=void 0===a.append||
a.append?!0:!1,0<e.length&&!F(e)&&(e=e.split(d.initialPreviewDelimiter)),d.overwriteInitial=!1,n("initialPreview",e),n("initialPreviewConfig",h),n("initialPreviewThumbTags",l),void 0!==b?c?(c=b.attr("data-fileindex"),d.uploadCache.content[c]=e[0],d.uploadCache.config[c]=h[0]||[],d.uploadCache.tags[c]=l[0]||[],d.uploadCache.append=a):(e=m.add(d.id,e,h[0],l[0],a),e=m.get(d.id,e,!1),g=f(e).hide(),b.after(g).fadeOut("slow",function(){g.fadeIn("slow").css("display:inline-block");d._initPreviewActions();
d._clearFileInput();b.remove()})):(m.set(d.id,e,h,l,a),d._initPreview(),d._initPreviewActions()))},_initSuccessThumbs:function(){var a=this;a.showPreview&&a._getThumbs(".file-preview-success").each(function(){var b=f(this),c=b.find(".kv-file-remove");c.removeAttr("disabled");q(c,"click",function(){var c=a._raise("filesuccessremove",[b.attr("id"),b.data("fileindex")]);R(b);!1!==c&&b.fadeOut("slow",function(){b.remove();a.$preview.find(".file-preview-frame").length||a.reset()})})})},_checkAsyncComplete:function(){var a,
b;for(b=0;b<this.filestack.length;b++)if(this.filestack[b]&&(a=this.previewInitId+"-"+b,-1===f.inArray(a,this.uploadLog)))return!1;return this.uploadAsyncCount===this.uploadLog.length},_uploadExtra:function(a,b){var c=this,d=c._getExtraData(a,b);0!==d.length&&f.each(d,function(a,b){c.formdata.append(a,b)})},_uploadSingle:function(a,b,c){var d=this,e=d.getFileStack().length,g=new FormData,h,l=d.previewInitId+"-"+a,n,p,u,x,q=0<d.filestack.length||!f.isEmptyObject(d.uploadExtraData),t,r={id:l,index:a};
d.formdata=g;d.showPreview&&(n=f("#"+l+":not(.file-preview-initial)"),u=n.find(".kv-file-upload"),x=n.find(".kv-file-remove"),f("#"+l).find(".file-thumb-progress").removeClass("hide"));0===e||!q||u&&u.hasClass("disabled")||d._abort(r)||(t=function(a,b){d.updateStack(a,void 0);d.uploadLog.push(b);d._checkAsyncComplete()&&(d.fileBatchCompleted=!0)},p=function(){var a=d.uploadCache;d.fileBatchCompleted&&setTimeout(function(){d.showPreview&&(m.set(d.id,a.content,a.config,a.tags,a.append),d.hasInitData&&
(d._initPreview(),d._initPreviewActions()));d.unlock();d._clearFileInput();d._raise("filebatchuploadcomplete",[d.filestack,d._getExtraData()]);d.uploadCount=0;d.uploadStatus={};d.uploadLog=[];d._setProgress(101)},100)},g.append(d.uploadFileAttr,b[a],d.filenames[a]),g.append("file_id",a),d._ajaxSubmit(function(b){h=d._getOutData(b);d.fileBatchCompleted=!1;d.showPreview&&(n.hasClass("file-preview-success")||(d._setThumbStatus(n,"Loading"),v(n,"file-uploading")),u.attr("disabled",!0),x.attr("disabled",
!0));c||d.lock();d._raise("filepreupload",[h,l,a]);f.extend(!0,r,h);d._abort(r)&&(b.abort(),d._setProgressCancelled())},function(b,e,g){var p=d.showPreview&&n.attr("id")?n.attr("id"):l;h=d._getOutData(g,b);f.extend(!0,r,h);setTimeout(function(){if(k(b)||k(b.error)){d.showPreview&&(d._setThumbStatus(n,"Success"),u.hide(),d._initUploadSuccess(b,n,c));d._raise("fileuploaded",[h,p,a]);c?t(a,p):d.updateStack(a,void 0);for(var e=0;e<b.length;e++)n.append('<input type="hidden" name="AdvertForm[images][]" value="'+
b[e]+'" />')}else d._showUploadError(b.error,r),d._setPreviewError(n,a),c&&t(a,p)},100)},function(){setTimeout(function(){d.showPreview&&(u.removeAttr("disabled"),x.removeAttr("disabled"),n.removeClass("file-uploading"),d._setProgress(101,f("#"+l).find(".file-thumb-progress")));c?p():(d.unlock(!1),d._clearFileInput());d._initSuccessThumbs()},100)},function(e,g,h){var p=d._parseError(e,h,c?b[a].name:null);setTimeout(function(){c&&t(a,l);d.uploadStatus[l]=100;d._setPreviewError(n,a);f.extend(!0,r,d._getOutData(e));
d._showUploadError(p,r)},100)},l,a))},_uploadBatch:function(){var a=this,b=a.filestack,c=b.length,d={},e=0<a.filestack.length||!f.isEmptyObject(a.uploadExtraData),g;a.formdata=new FormData;0!==c&&e&&!a._abort(d)&&(g=function(){f.each(b,function(b){a.updateStack(b,void 0)});a._clearFileInput()},f.each(b,function(c,d){k(b[c])||a.formdata.append(a.uploadFileAttr,d,a.filenames[c])}),a._ajaxSubmit(function(b){a.lock();var c=a._getOutData(b);a.showPreview&&a._getThumbs().each(function(){var b=f(this),c=
b.find(".kv-file-upload"),d=b.find(".kv-file-remove");b.hasClass("file-preview-success")||(a._setThumbStatus(b,"Loading"),v(b,"file-uploading"));c.attr("disabled",!0);d.attr("disabled",!0)});a._raise("filebatchpreupload",[c]);a._abort(c)&&(b.abort(),a._setProgressCancelled())},function(b,c,d){c=a._getOutData(d,b);d=a._getThumbs(":not(.file-preview-error)");var e=0,h=k(b)||k(b.errorkeys)?[]:b.errorkeys;k(b)||k(b.error)?(a._raise("filebatchuploadsuccess",[c]),g(),a.showPreview?(d.each(function(){var b=
f(this),c=b.find(".kv-file-upload");b.find(".kv-file-upload").hide();a._setThumbStatus(b,"Success");b.removeClass("file-uploading");c.removeAttr("disabled")}),a._initUploadSuccess(b)):a.reset()):(a.showPreview&&(d.each(function(){var b=f(this),c=b.find(".kv-file-remove"),d=b.find(".kv-file-upload");b.removeClass("file-uploading");d.removeAttr("disabled");c.removeAttr("disabled");0===h.length?a._setPreviewError(b):(-1!==f.inArray(e,h)?a._setPreviewError(b):(b.find(".kv-file-upload").hide(),a._setThumbStatus(b,
"Success"),a.updateStack(e,void 0)),e++)}),a._initUploadSuccess(b)),a._showUploadError(b.error,c,"filebatchuploaderror"))},function(){a._setProgress(101);a.unlock();a._initSuccessThumbs();a._clearFileInput();a._raise("filebatchuploadcomplete",[a.filestack,a._getExtraData()])},function(b,d,e){d=a._getOutData(b);b=a._parseError(b,e);a._showUploadError(b,d,"filebatchuploaderror");a.uploadFileCount=c-1;a.showPreview&&(a._getThumbs().each(function(){var b=f(this),c=b.attr("data-fileindex");b.removeClass("file-uploading");
void 0!==a.filestack[c]&&a._setPreviewError(b)}),a._getThumbs().removeClass("file-uploading"),a._getThumbs(" .kv-file-upload").removeAttr("disabled"),a._getThumbs(" .kv-file-delete").removeAttr("disabled"))}))},_uploadExtraOnly:function(){var a=this,b={};a.formdata=new FormData;a._abort(b)||a._ajaxSubmit(function(c){a.lock();var d=a._getOutData(c);a._raise("filebatchpreupload",[d]);a._setProgress(50);b.data=d;b.xhr=c;a._abort(b)&&(c.abort(),a._setProgressCancelled())},function(b,d,e){d=a._getOutData(e,
b);k(b)||k(b.error)?(a._raise("filebatchuploadsuccess",[d]),a._clearFileInput(),a._initUploadSuccess(b)):a._showUploadError(b.error,d,"filebatchuploaderror")},function(){a._setProgress(101);a.unlock();a._clearFileInput();a._raise("filebatchuploadcomplete",[a.filestack,a._getExtraData()])},function(c,d,e){d=a._getOutData(c);c=a._parseError(c,e);b.data=d;a._showUploadError(c,d,"filebatchuploaderror")})},_initFileActions:function(){var a=this;a.showPreview&&(a._initZoomButton(),a.$preview.find(".kv-file-remove").each(function(){var b=
f(this),c=b.closest(".file-preview-frame"),d,e=c.attr("id"),g=c.attr("data-fileindex"),h,l,n;q(b,"click",function(){n=a._raise("filepreremove",[e,g]);if(!1===n||!a._validateMinCount())return!1;d=c.hasClass("file-preview-error");R(c);c.fadeOut("slow",function(){a.updateStack(g,void 0);a._clearObjects(c);c.remove();e&&d&&a.$errorContainer.find('li[data-file-id="'+e+'"]').fadeOut("fast",function(){f(this).remove();a._errorsExist()||a._resetErrors()});a._clearFileInput();var b=a.getFileStack(!0),n=m.count(a.id),
k=b.length,q=a.showPreview&&a.$preview.find(".file-preview-frame").length;0!==k||0!==n||q?(h=n+k,l=1<h?a._getMsgSelected(h):b[0]?a._getFileNames()[0]:"",a._setCaption(l)):a.reset();a._raise("fileremoved",[e,g])})})}),a.$preview.find(".kv-file-upload").each(function(){var b=f(this);q(b,"click",function(){var c=b.closest(".file-preview-frame"),d=c.attr("data-fileindex");c.hasClass("file-preview-error")||a._uploadSingle(d,a.filestack,!1)})}))},_hideFileIcon:function(){this.overwriteInitial&&this.$captionContainer.find(".kv-caption-icon").hide()},
_showFileIcon:function(){this.$captionContainer.find(".kv-caption-icon").show()},_getSize:function(a){var b=parseFloat(a);if(!a||!b||isNaN(a)||isNaN(b))return this._getLayoutTemplate("size").replace("{sizeText}","0.00 KB");var c=this.fileSizeGetter;"function"===typeof c?b=c(a):(a=Math.floor(Math.log(b)/Math.log(1024)),c="B KB MB GB TB PB EB ZB YB".split(" "),b=1*(b/Math.pow(1024,a)).toFixed(2)+" "+c[a]);return this._getLayoutTemplate("size").replace("{sizeText}",b)},_generatePreviewTemplate:function(a,
b,c,d,e,g,h,f,n,p){var l=this._getPreviewTemplate(a);f=f||"";var k=y(a,this.previewSettings,W[a]),m=this.slug(c);g=n||this._renderFileFooter(m,h,k.width,g);p=p||e.slice(e.lastIndexOf("-")+1);l=this._parseFilePreviewIcon(l,c);"text"===a||"html"===a?(b="text"===a?X(b):b,a=l.replace(/\{previewId}/g,e).replace(/\{caption}/g,m).replace(/\{width}/g,k.width).replace(/\{height}/g,k.height).replace(/\{frameClass}/g,f).replace(/\{cat}/g,d).replace(/\{footer}/g,g).replace(/\{fileindex}/g,p).replace(/\{data}/g,
b).replace(/\{template}/g,a)):a=l.replace(/\{previewId}/g,e).replace(/\{caption}/g,m).replace(/\{frameClass}/g,f).replace(/\{type}/g,d).replace(/\{fileindex}/g,p).replace(/\{width}/g,k.width).replace(/\{height}/g,k.height).replace(/\{footer}/g,g).replace(/\{data}/g,b).replace(/\{template}/g,a);return a},_previewDefault:function(a,b,c){var d=this.$preview,e=d.find(".file-live-thumbs");if(this.showPreview){var g=a?a.name:"",h=a?a.type:"",l=!0===c&&!this.isUploadable,n=O.createObjectURL(a);this._clearDefaultPreview();
a=this._generatePreviewTemplate("other",n,g,h,b,l,a.size);e.length||(e=f(document.createElement("div")).addClass("file-live-thumbs").appendTo(d));e.append("\n"+a);!0===c&&this.isUploadable&&this._setThumbStatus(f("#"+b),"Error")}},_previewFile:function(a,b,c,d,e){if(this.showPreview){var g=this._parseFileType(b),h=b?b.name:"",l=this.slug(h),n=this.allowedPreviewTypes,p=this.allowedPreviewMimeTypes,k=this.$preview,m=n&&0<=n.indexOf(g),n=k.find(".file-live-thumbs");c="text"===g||"html"===g||"image"===
g?c.target.result:e;p=p&&-1!==p.indexOf(b.type);n.length||(n=f(document.createElement("div")).addClass("file-live-thumbs").appendTo(k));"html"===g&&this.purifyHtml&&window.DOMPurify&&(c=window.DOMPurify.sanitize(c));m||p?(g=this._generatePreviewTemplate(g,c,h,b.type,d,!1,b.size),this._clearDefaultPreview(),n.append("\n"+g),this._validateImage(a,d,l,b.type)):this._previewDefault(b,d);this._initSortable()}},_slugDefault:function(a){return k(a)?"":String(a).replace(/[\-\[\]\/\{}:;#%=\(\)\*\+\?\\\^\$\|<>&"']/g,
"_")},_readFiles:function(a){this.reader=new FileReader;var b=this,c=b.$element,d=b.$preview,e=b.reader,g=b.$previewContainer,h=b.$previewStatus,l=b.msgLoading,n=b.msgProgress,p=b.previewInitId,m=a.length,q=b.fileTypeSettings,v=b.filestack.length,t,N=b.maxFilePreviewSize&&parseFloat(b.maxFilePreviewSize),E=d.length&&(!N||isNaN(N)),B=function(c,d,e,g){var h=f.extend(!0,{},b._getOutData({},{},a),{id:e,index:g}),l={id:e,index:g,file:d,files:a};b._previewDefault(d,e,!0);b.isUploadable&&(b.addToStack(void 0),
setTimeout(function(){t(g+1)},100));b._initFileActions();b.removeFromPreviewOnError&&f("#"+e).remove();return b.isUploadable?b._showUploadError(c,h):b._showError(c,l)};b.loadedImages=[];b.totalImagesCount=0;f.each(a,function(a,c){var d=b.fileTypeSettings.image||J.image;d&&d(c.type)&&b.totalImagesCount++});t=function(f){k(c.attr("multiple"))&&(m=1);if(f>=m)b.isUploadable&&0<b.filestack.length?b._raise("filebatchselected",[b.getFileStack()]):b._raise("filebatchselected",[a]),g.removeClass("file-thumb-loading"),
h.html("");else{var u=p+"-"+(v+f),x,K,w=a[f],H,A=w.name?b.slug(w.name):"";x=(w.size||0)/1E3;var D;K="";var G=O.createObjectURL(w),C=0,z,L=b.allowedFileTypes,fa=k(L)?"":L.join(", "),M=b.allowedFileExtensions,I=k(M)?"":M.join(", ");if(!1===A)t(f+1);else if(0===A.length)z=b.msgInvalidFileName.replace("{name}",X(w.name)),b.isError=B(z,w,u,f);else if(k(M)||(K=new RegExp("\\.("+M.join("|")+")$","i")),H=x.toFixed(2),0<b.maxFileSize&&x>b.maxFileSize)z=b.msgSizeTooLarge.replace("{name}",A).replace("{size}",
H).replace("{maxSize}",b.maxFileSize),b.isError=B(z,w,u,f);else if(null!==b.minFileSize&&x<=T(b.minFileSize))z=b.msgSizeTooSmall.replace("{name}",A).replace("{size}",H).replace("{minSize}",b.minFileSize),b.isError=B(z,w,u,f);else{if(!k(L)&&F(L)){for(H=0;H<L.length;H+=1)D=L[H],D=q[D],D=void 0!==D&&D(w.type,A),C+=k(D)?0:D.length;if(0===C){z=b.msgInvalidFileType.replace("{name}",A).replace("{types}",fa);b.isError=B(z,w,u,f);return}}if(0===C&&!k(M)&&F(M)&&!k(K)&&(D=r(A,K),C+=k(D)?0:D.length,0===C)){z=
b.msgInvalidFileExtension.replace("{name}",A).replace("{extensions}",I);b.isError=B(z,w,u,f);return}b.showPreview?!E&&x>N?(b.addToStack(w),g.addClass("file-thumb-loading"),b._previewDefault(w,u),b._initFileActions(),b._updateFileDetails(m),t(f+1)):(d.length&&void 0!==FileReader?(h.html(l.replace("{index}",f+1).replace("{files}",m)),g.addClass("file-thumb-loading"),e.onerror=function(a){b._errorHandler(a,A)},e.onload=function(a){b._previewFile(f,w,a,u,G);b._initFileActions()},e.onloadend=function(){z=
n.replace("{index}",f+1).replace("{files}",m).replace("{percent}",50).replace("{name}",A);setTimeout(function(){h.html(z);b._updateFileDetails(m);t(f+1)},100);b._raise("fileloaded",[w,u,f,e])},e.onprogress=function(a){a.lengthComputable&&(a=Math.ceil(a.loaded/a.total*100),z=n.replace("{index}",f+1).replace("{files}",m).replace("{percent}",a).replace("{name}",A),setTimeout(function(){h.html(z)},100))},x=y("text",q,J.text),K=y("image",q,J.image),x(w.type,A)?e.readAsText(w,b.textEncoding):K(w.type,A)?
e.readAsDataURL(w):e.readAsArrayBuffer(w)):(b._previewDefault(w,u),setTimeout(function(){t(f+1);b._updateFileDetails(m)},100),b._raise("fileloaded",[w,u,f,e])),b.addToStack(w)):(b.addToStack(w),setTimeout(function(){t(f+1)},100),b._raise("fileloaded",[w,u,f,e]))}}};t(0);b._updateFileDetails(m,!1)},_updateFileDetails:function(a){var b=this.$element,c=this.getFileStack(),b=B(9)&&da(b.val())||b[0].files[0]&&b[0].files[0].name||c.length&&c[0].name||"",b=this.slug(b),c=this.isUploadable?c.length:a,d=m.count(this.id)+
c,c=1<c?this._getMsgSelected(d):b;this.isError?(this.$previewContainer.removeClass("file-thumb-loading"),this.$previewStatus.html(""),this.$captionContainer.find(".kv-caption-icon").hide()):this._showFileIcon();this._setCaption(c,this.isError);this.$container.removeClass("file-input-new file-input-ajax-new");1===arguments.length&&this._raise("fileselect",[a,b]);m.count(this.id)&&this._initPreviewActions()},_setThumbStatus:function(a,b){if(this.showPreview){var c="indicator"+b,d=c+"Title",e="file-preview-"+
b.toLowerCase(),g=a.find(".file-upload-indicator"),f=this.fileActionSettings;a.removeClass("file-preview-success file-preview-error file-preview-loading");"Error"===b&&a.find(".kv-file-upload").attr("disabled",!0);"Success"===b&&(a.find(".file-drag-handle").remove(),g.css("margin-left",0));g.html(f[c]);g.attr("title",f[d]);a.addClass(e)}},_setProgressCancelled:function(){this._setProgress(101,this.$progress,this.msgCancelled)},_setProgress:function(a,b,c){var d=Math.min(a,100),e=100>d?this.progressTemplate:
c?this.progressErrorTemplate:100>=a?this.progressTemplate:this.progressCompleteTemplate,g=this.progressUploadThreshold;b=b||this.$progress;k(e)||(g&&d>g&&100>=a?(a=e.replace("{percent}",g).replace("{percent}",g).replace("{percent}%",this.msgUploadThreshold),b.html(a)):b.html(e.replace(/\{percent}/g,d)),c&&b.find('[role="progressbar"]').html(c))},_setFileDropZoneTitle:function(){var a=this.$container.find(".file-drop-zone"),b=this.dropZoneTitle,c;this.isClickable&&(c=k(this.$element.attr("multiple"))?
this.fileSingle:this.filePlural,b+=this.dropZoneClickTitle.replace("{files}",c));a.find("."+this.dropZoneTitleClass).remove();this.isUploadable&&this.showPreview&&0!==a.length&&!(0<this.getFileStack().length)&&this.dropZoneEnabled&&(0===a.find(".file-preview-frame").length&&k(this.defaultPreviewContent)&&a.prepend('<div class="'+this.dropZoneTitleClass+'">'+b+"</div>"),this.$container.removeClass("file-input-new"),v(this.$container,"file-input-ajax-new"))},_setAsyncUploadStatus:function(a,b,c){var d=
0;this._setProgress(b,f("#"+a).find(".file-thumb-progress"));this.uploadStatus[a]=b;f.each(this.uploadStatus,function(a,b){d+=b});this._setProgress(Math.floor(d/c))},_validateMinCount:function(){var a=this.isUploadable?this.getFileStack().length:this.$element.get(0).files.length;return this.validateInitialCount&&0<this.minFileCount&&this._getFileCount(a-1)<this.minFileCount?(this._noFilesError({}),!1):!0},_getFileCount:function(a){var b;this.validateInitialCount&&!this.overwriteInitial&&(b=m.count(this.id),
a+=b);return a},_getFileName:function(a){return a&&a.name?this.slug(a.name):void 0},_getFileNames:function(a){return this.filenames.filter(function(b){return a?void 0!==b:void 0!==b&&null!==b})},_setPreviewError:function(a,b,c){void 0!==b&&this.updateStack(b,c);this.removeFromPreviewOnError?a.remove():this._setThumbStatus(a,"Error")},_checkDimensions:function(a,b,c,d,e,g,f){var h=this[("Small"===b?"min":"max")+"Image"+g];!k(h)&&c.length&&(c=c[0],c="Width"===g?c.naturalWidth||c.width:c.naturalHeight||
c.height,("Small"===b?c>=h:c<=h)||(b=this["msgImage"+g+b].replace("{name}",e).replace("{size}",h),this._showUploadError(b,f),this._setPreviewError(d,a,null)))},_validateImage:function(a,b,c,d){var e=this,g=e.$preview,f,l,n,p=g.find("#"+b),k=p.find("img");c=c||"Untitled";k.length&&q(k,"load",function(){l=p.width();n=g.width();l>n&&(k.css("width","100%"),p.css("width","97%"));f={ind:a,id:b};e._checkDimensions(a,"Small",k,p,c,"Width",f);e._checkDimensions(a,"Small",k,p,c,"Height",f);e.resizeImage||(e._checkDimensions(a,
"Large",k,p,c,"Width",f),e._checkDimensions(a,"Large",k,p,c,"Height",f));e._raise("fileimageloaded",[b]);e.loadedImages.push({ind:a,img:k,thumb:p,pid:b,typ:d});e._validateAllImages()})},_validateAllImages:function(){var a,b,c,d,e,g,f,l;if(this.loadedImages.length===this.totalImagesCount&&(this._raise("fileimagesloaded"),this.resizeImage)){l=this.isUploadable?this._showUploadError:this._showError;var n={val:0};for(a=0;a<this.loadedImages.length;a++)b=this.loadedImages[a],c=b.img,d=b.thumb,e=b.pid,
g=b.ind,f={id:e,index:g},this._getResizedImage(c[0],b.typ,e,g,n,this.loadedImages.length)||(l(this.msgImageResizeError,f,"fileimageresizeerror"),this._setPreviewError(d,g))}},_getResizedImage:function(a,b,c,d,e,g){var f=this,l=a.naturalWidth,n=a.naturalHeight,k=1,k=f.maxImageWidth||l,m=f.maxImageHeight||n,q,r,t=f.imageCanvas,v=f.imageCanvasContext;if(!l||!n)return e.val++,e.val===g&&f._raise("fileimagesresized"),!1;if(l===k&&n===m)return f._raise("fileimageresized",[c,d]),e.val++,e.val===g&&f._raise("fileimagesresized"),
!0;b=b||f.resizeDefaultImageType;q=l>k;r=n>m;k="width"===f.resizePreference?q?k/l:r?m/n:1:r?m/n:q?k/l:1;f._resetCanvas();l*=k;n*=k;t.width=l;t.height=n;try{return v.drawImage(a,0,0,l,n),t.toBlob(function(a){f.filestack[d]=a;f._raise("fileimageresized",[c,d]);e.val++;e.val===g&&f._raise("fileimagesresized",[void 0,void 0])},b,f.resizeQuality),!0}catch(ea){return e.val++,e.val===g&&f._raise("fileimagesresized",[void 0,void 0]),!1}},_initBrowse:function(a){this.showBrowse?(this.$btnFile=a.find(".btn-file"),
this.$btnFile.append(this.$element)):this.$element.hide()},_initCaption:function(){var a=this.initialCaption||"";if(this.overwriteInitial||k(a))return this.$caption.html(""),!1;this._setCaption(a);return!0},_setCaption:function(a,b){var c,d,e=this.getFileStack();if(this.$caption.length){if(b)c=f("<div>"+this.msgValidationError+"</div>").text(),d=(d=e.length)?1===d&&e[0]?this._getFileNames()[0]:this._getMsgSelected(d):this._getMsgSelected(this.msgNo),d='<span class="'+this.msgValidationErrorClass+
'">'+this.msgValidationErrorIcon+(k(a)?d:a)+"</span>";else{if(k(a))return;c=f("<div>"+a+"</div>").text();d=this._getLayoutTemplate("fileIcon")+c}this.$caption.html(d);this.$caption.attr("title",c);this.$captionContainer.find(".file-caption-ellipsis").attr("title",c)}},_createContainer:function(){var a=f(document.createElement("div")).attr({"class":"file-input file-input-new"}).html(this._renderMain());this.$element.before(a);this._initBrowse(a);this.theme&&a.addClass("theme-"+this.theme);return a},
_refreshContainer:function(){var a=this.$container;a.before(this.$element);a.html(this._renderMain());this._initBrowse(a)},_renderMain:function(){var a=this.isUploadable&&this.dropZoneEnabled?" file-drop-zone":"file-drop-disabled",b=this.showClose?this._getLayoutTemplate("close"):"",a=this.showPreview?this._getLayoutTemplate("preview").replace(/\{class}/g,this.previewClass).replace(/\{dropClass}/g,a):"",c=this.captionTemplate.replace(/\{class}/g,(this.isDisabled?this.captionClass+" file-caption-disabled":
this.captionClass)+" kv-fileinput-caption");return this.mainTemplate.replace(/\{class}/g,this.mainClass+(!this.showBrowse&&this.showCaption?" no-browse":"")).replace(/\{preview}/g,a).replace(/\{close}/g,b).replace(/\{caption}/g,c).replace(/\{upload}/g,this._renderButton("upload")).replace(/\{remove}/g,this._renderButton("remove")).replace(/\{cancel}/g,this._renderButton("cancel")).replace(/\{browse}/g,this._renderButton("browse"))},_renderButton:function(a){var b=this._getLayoutTemplate("btnDefault"),
c=this[a+"Class"],d=this[a+"Title"],e=this[a+"Icon"],f=this[a+"Label"],h=this.isDisabled?" disabled":"",l="button";switch(a){case "remove":if(!this.showRemove)return"";break;case "cancel":if(!this.showCancel)return"";c+=" hide";break;case "upload":if(!this.showUpload)return"";this.isUploadable&&!this.isDisabled?b=this._getLayoutTemplate("btnLink").replace("{href}",this.uploadUrl):l="submit";break;case "browse":if(!this.showBrowse)return"";b=this._getLayoutTemplate("btnBrowse");break;default:return""}c+=
"browse"===a?" btn-file":" fileinput-"+a+" fileinput-"+a+"-button";k(f)||(f=' <span class="'+this.buttonLabelClass+'">'+f+"</span>");return b.replace("{type}",l).replace("{css}",c).replace("{title}",d).replace("{status}",h).replace("{icon}",e).replace("{label}",f)},_renderThumbProgress:function(){return'<div class="file-thumb-progress hide">'+this.progressTemplate.replace(/\{percent}/g,"0")+"</div>"},_renderFileFooter:function(a,b,c,d){var e=this.fileActionSettings,f=e.showRemove,h=e.showDrag,k=e.showUpload,
n=e.showZoom,m=this._getLayoutTemplate("footer"),q=d?e.indicatorError:e.indicatorNew;d=d?e.indicatorErrorTitle:e.indicatorNewTitle;b=this._getSize(b);a=this.isUploadable?m.replace(/\{actions}/g,this._renderFileActions(k,f,n,h,!1,!1,!1)).replace(/\{caption}/g,a).replace(/\{size}/g,b).replace(/\{width}/g,c).replace(/\{progress}/g,this._renderThumbProgress()).replace(/\{indicator}/g,q).replace(/\{indicatorTitle}/g,d):m.replace(/\{actions}/g,this._renderFileActions(!1,!1,n,h,!1,!1,!1)).replace(/\{caption}/g,
a).replace(/\{size}/g,b).replace(/\{width}/g,c).replace(/\{progress}/g,"").replace(/\{indicator}/g,q).replace(/\{indicatorTitle}/g,d);return a=G(a,this.previewThumbTags)},_renderFileActions:function(a,b,c,d,e,f,h,k){if(!(a||b||c||d))return"";f=!1===f?"":' data-url="'+f+'"';var g=!1===h?"":' data-key="'+h+'"',l=h="",m="",q="",r=this._getLayoutTemplate("actions"),t=this.fileActionSettings,v=this.otherActionButtons.replace(/\{dataKey}/g,g);e=e?t.removeClass+" disabled":t.removeClass;b&&(h=this._getLayoutTemplate("actionDelete").replace(/\{removeClass}/g,
e).replace(/\{removeIcon}/g,t.removeIcon).replace(/\{removeTitle}/g,t.removeTitle).replace(/\{dataUrl}/g,f).replace(/\{dataKey}/g,g));a&&(l=this._getLayoutTemplate("actionUpload").replace(/\{uploadClass}/g,t.uploadClass).replace(/\{uploadIcon}/g,t.uploadIcon).replace(/\{uploadTitle}/g,t.uploadTitle));c&&(m=this._getLayoutTemplate("actionZoom").replace(/\{zoomClass}/g,t.zoomClass).replace(/\{zoomIcon}/g,t.zoomIcon).replace(/\{zoomTitle}/g,t.zoomTitle));d&&k&&(a="drag-handle-init "+t.dragClass,q=this._getLayoutTemplate("actionDrag").replace(/\{dragClass}/g,
a).replace(/\{dragTitle}/g,t.dragTitle).replace(/\{dragIcon}/g,t.dragIcon));return r.replace(/\{delete}/g,h).replace(/\{upload}/g,l).replace(/\{zoom}/g,m).replace(/\{drag}/g,q).replace(/\{other}/g,v)},_browse:function(a){this._raise("filebrowse");a&&a.isDefaultPrevented()||(this.isError&&!this.isUploadable&&this.clear(),this.$captionContainer.focus())},_change:function(a){var b=this.$element;if(!this.isUploadable&&k(b.val())&&this.fileInputCleared)this.fileInputCleared=!1;else{this.fileInputCleared=
!1;var c,d,e;c=1<arguments.length;d=this.isUploadable;e=0;var g,h=c?a.originalEvent.dataTransfer.files:b.get(0).files,l=this.filestack.length,b=k(b.attr("multiple"))&&0<l,n=0;this.reader=null;this._resetUpload();this._hideFileIcon();this.isUploadable&&this.$container.find(".file-drop-zone ."+this.dropZoneTitleClass).remove();if(c)for(c=[];h[e];)g=h[e],g.type||0!==g.size%4096?c.push(g):n++,e++;else c=void 0===a.target.files?a.target&&a.target.value?[{name:a.target.value.replace(/^.+\\/,"")}]:[]:a.target.files;
if(k(c)||0===c.length)d||this.clear(),this._showFolderError(n),this._raise("fileselectnone");else{this._resetErrors();g=c.length;e=this._getFileCount(this.isUploadable?this.getFileStack().length+g:g);if(0<this.maxFileCount&&e>this.maxFileCount){if(!this.autoReplace||g>this.maxFileCount){d=this.autoReplace&&g>this.maxFileCount?g:e;d=this.msgFilesTooMany.replace("{m}",this.maxFileCount).replace("{n}",d);l=f.extend(!0,{},this._getOutData({},{},h),{id:null,index:null});h={id:null,index:null,file:null,
files:h};this.isError=this.isUploadable?this._showUploadError(d,l):this._showError(d,h);this.$captionContainer.find(".kv-caption-icon").hide();this._setCaption("",!0);this.$container.removeClass("file-input-new file-input-ajax-new");return}e>this.maxFileCount&&this._resetPreviewThumbs(d)}else!d||b?(this._resetPreviewThumbs(!1),b&&this.clearStack()):!d||0!==l||m.count(this.id)&&!this.overwriteInitial||this._resetPreviewThumbs(!0);this.isPreviewable?this._readFiles(c):this._updateFileDetails(1);this._showFolderError(n)}}},
_abort:function(a){return this.ajaxAborted&&"object"===typeof this.ajaxAborted&&void 0!==this.ajaxAborted.message?(a=f.extend(!0,{},this._getOutData(),a),a.abortData=this.ajaxAborted.data||{},a.abortMessage=this.ajaxAborted.message,this.cancel(),this._setProgress(101,this.$progress,this.msgCancelled),this._showUploadError(this.ajaxAborted.message,a,"filecustomerror"),!0):!1},_resetFileStack:function(){var a=this,b=0,c=[],d=[];a._getThumbs().each(function(){var e=f(this),g=e.attr("data-fileindex"),
h=a.filestack[g];-1!==g&&(void 0!==h?(c[b]=h,d[b]=a._getFileName(h),e.attr({id:a.previewInitId+"-"+b,"data-fileindex":b}),b++):e.attr({id:"uploaded-"+Q(),"data-fileindex":"-1"}))});a.filestack=c;a.filenames=d},clearStack:function(){this.filestack=[];this.filenames=[];return this.$element},updateStack:function(a,b){this.filestack[a]=b;this.filenames[a]=this._getFileName(b);return this.$element},addToStack:function(a){this.filestack.push(a);this.filenames.push(this._getFileName(a));return this.$element},
getFileStack:function(a){return this.filestack.filter(function(b){return a?void 0!==b:void 0!==b&&null!==b})},getFilesCount:function(){var a=this.isUploadable?this.getFileStack().length:this.$element.get(0).files.length;return this._getFileCount(a)},lock:function(){this._resetErrors();this.disable();this.showRemove&&v(this.$container.find(".fileinput-remove"),"hide");this.showCancel&&this.$container.find(".fileinput-cancel").removeClass("hide");this._raise("filelock",[this.filestack,this._getExtraData()]);
return this.$element},unlock:function(a){void 0===a&&(a=!0);this.enable();this.showCancel&&v(this.$container.find(".fileinput-cancel"),"hide");this.showRemove&&this.$container.find(".fileinput-remove").removeClass("hide");a&&this._resetFileStack();this._raise("fileunlock",[this.filestack,this._getExtraData()]);return this.$element},cancel:function(){var a=this,b=a.ajaxRequests,c=b.length,d;if(0<c)for(d=0;d<c;d+=1)a.cancelling=!0,b[d].abort();a._setProgressCancelled();a._getThumbs().each(function(){var b=
f(this),c=b.attr("data-fileindex");b.removeClass("file-uploading");void 0!==a.filestack[c]&&(b.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled"),b.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled"));a.unlock()});return a.$element},clear:function(){var a=this,b;a.$btnUpload.removeAttr("disabled");a._getThumbs().find("video,audio,img").each(function(){R(f(this))});a._resetUpload();a.clearStack();a._clearFileInput();a._resetErrors(!0);a._raise("fileclear");a._hasInitialPreview()?
(a._showFileIcon(),a._resetPreview(),a._initPreviewActions(),a.$container.removeClass("file-input-new")):(a._getThumbs().each(function(){a._clearObjects(f(this))}),a.isUploadable&&(m.data[a.id]={}),a.$preview.html(""),b=!a.overwriteInitial&&0<a.initialCaption.length?a.initialCaption:"",a.$caption.html(b),a.$caption.attr("title",""),v(a.$container,"file-input-new"),a._validateDefaultPreview());0===a.$container.find(".file-preview-frame").length&&(a._initCaption()||a.$captionContainer.find(".kv-caption-icon").hide());
a._hideFileIcon();a._raise("filecleared");a.$captionContainer.focus();a._setFileDropZoneTitle();return a.$element},reset:function(){this._resetPreview();this.$container.find(".fileinput-filename").text("");this._raise("filereset");v(this.$container,"file-input-new");(this.$preview.find(".file-preview-frame").length||this.isUploadable&&this.dropZoneEnabled)&&this.$container.removeClass("file-input-new");this._setFileDropZoneTitle();this.clearStack();this.formdata={};return this.$element},disable:function(){this.isDisabled=
!0;this._raise("filedisabled");this.$element.attr("disabled","disabled");this.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled");this.$container.find(".btn-file, .fileinput-remove, .fileinput-upload, .file-preview-frame button").attr("disabled",!0);this._initDragDrop();return this.$element},enable:function(){this.isDisabled=!1;this._raise("fileenabled");this.$element.removeAttr("disabled");this.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled");this.$container.find(".btn-file, .fileinput-remove, .fileinput-upload, .file-preview-frame button").removeAttr("disabled");
this._initDragDrop();return this.$element},upload:function(){var a=this.getFileStack().length,b={},c=!f.isEmptyObject(this._getExtraData());if(0<this.minFileCount&&this._getFileCount(a)<this.minFileCount)this._noFilesError(b);else if(this.isUploadable&&!this.isDisabled&&(0!==a||c))if(this._resetUpload(),this.$progress.removeClass("hide"),this.uploadCount=0,this.uploadStatus={},this.uploadLog=[],this.lock(),this._setProgress(2),0===a&&c)this._uploadExtraOnly();else if(a=this.filestack.length,this.hasInitData=
!1,this.uploadAsync){b=this._getOutData();this._raise("filebatchpreupload",[b]);this.fileBatchCompleted=!1;this.uploadCache={content:[],config:[],tags:[],append:!0};this.uploadAsyncCount=this.getFileStack().length;for(b=0;b<a;b++)this.uploadCache.content[b]=null,this.uploadCache.config[b]=null,this.uploadCache.tags[b]=null;for(b=0;b<a;b++)void 0!==this.filestack[b]&&this._uploadSingle(b,this.filestack,!0)}else return this._uploadBatch(),this.$element},destroy:function(){var a=this.$container;a.find(".file-drop-zone").off();
this.$element.insertBefore(a).off(".fileinput").removeData();a.off().remove();return this.$element},refresh:function(a){var b=this.$element;a=a?f.extend(!0,{},this.options,a):this.options;this.destroy();b.fileinput(a);b.val()&&b.trigger("change.fileinput");return b}};f.fn.fileinput=function(a){if(I()||B(9)){var b=Array.apply(null,arguments),c=[];b.shift();this.each(function(){var d=f(this),e=d.data("fileinput"),g="object"===typeof a&&a,h=g.theme||d.data("theme"),l={},n={},m=g.language||d.data("language")||
"en";e||(h&&(n=f.fn.fileinputThemes[h]||{}),"en"===m||k(f.fn.fileinputLocales[m])||(l=f.fn.fileinputLocales[m]||{}),e=f.extend(!0,{},f.fn.fileinput.defaults,n,f.fn.fileinputLocales.en,l,g,d.data()),e=new C(this,e),d.data("fileinput",e));"string"===typeof a&&c.push(e[a].apply(e,b))});switch(c.length){case 0:return this;case 1:return c[0];default:return c}}};f.fn.fileinput.defaults={language:"en",showCaption:!0,showBrowse:!0,showPreview:!0,showRemove:!0,showUpload:!0,showCancel:!0,showClose:!0,showUploadedThumbs:!0,
browseOnZoneClick:!1,autoReplace:!1,previewClass:"",captionClass:"",mainClass:"file-caption-main",mainTemplate:null,purifyHtml:!0,fileSizeGetter:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewAsData:!1,initialPreviewFileType:"image",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:!0,removeFromPreviewOnError:!1,deleteUrl:"",deleteExtraData:{},overwriteInitial:!0,layoutTemplates:U,previewTemplates:V,previewZoomSettings:{image:{width:"auto",
height:"auto","max-width":"100%","max-height":"100%"},html:{width:"100%",height:"100%","min-height":"480px"},text:{width:"100%",height:"100%","min-height":"480px"},video:{width:"auto",height:"100%","max-width":"100%"},audio:{width:"100%",height:"30px"},flash:{width:"auto",height:"480px"},object:{width:"auto",height:"100%","min-height":"480px"},pdf:{width:"100%",height:"100%","min-height":"480px"},other:{width:"auto",height:"100%","min-height":"480px"}},previewZoomButtonIcons:{prev:'<i class="glyphicon glyphicon-triangle-left"></i>',
next:'<i class="glyphicon glyphicon-triangle-right"></i>',toggleheader:'<i class="glyphicon glyphicon-resize-vertical"></i>',fullscreen:'<i class="glyphicon glyphicon-fullscreen"></i>',borderless:'<i class="glyphicon glyphicon-resize-full"></i>',close:'<i class="glyphicon glyphicon-remove"></i>'},previewZoomButtonClasses:{prev:"btn btn-navigate",next:"btn btn-navigate",toggleheader:"btn btn-default btn-header-toggle",fullscreen:"btn btn-default",borderless:"btn btn-default",close:"btn btn-default"},
allowedPreviewTypes:P,allowedPreviewMimeTypes:null,allowedFileTypes:null,allowedFileExtensions:null,defaultPreviewContent:null,customLayoutTags:{},customPreviewTags:{},previewSettings:W,fileTypeSettings:J,previewFileIcon:'<i class="glyphicon glyphicon-file"></i>',previewFileIconClass:"file-other-icon",previewFileIconSettings:{},previewFileExtSettings:{},buttonLabelClass:"hidden-xs",browseIcon:'<i class="glyphicon glyphicon-folder-open"></i>&nbsp;',browseClass:"btn btn-primary",removeIcon:'<i class="glyphicon glyphicon-trash"></i>',
removeClass:"btn btn-default",cancelIcon:'<i class="glyphicon glyphicon-ban-circle"></i>',cancelClass:"btn btn-default",uploadIcon:'<i class="glyphicon glyphicon-upload"></i>',uploadClass:"btn btn-default",uploadUrl:null,uploadAsync:!0,uploadExtraData:{},zoomModalHeight:480,minImageWidth:null,minImageHeight:null,maxImageWidth:null,maxImageHeight:null,resizeImage:!1,resizePreference:"width",resizeQuality:.92,resizeDefaultImageType:"image/jpeg",minFileSize:0,maxFileSize:0,maxFilePreviewSize:25600,minFileCount:0,
maxFileCount:0,validateInitialCount:!1,msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"></i> ',msgErrorClass:"file-error-message",progressThumbClass:"progress-bar progress-bar-success progress-bar-striped active",progressClass:"progress-bar progress-bar-success progress-bar-striped active",progressCompleteClass:"progress-bar progress-bar-success",progressErrorClass:"progress-bar progress-bar-danger",progressUploadThreshold:99,previewFileType:"image",
elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,errorCloseButton:'<span class="close kv-error-close">&times;</span>',slugCallback:null,dropZoneEnabled:!0,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:!0};f.fn.fileinputLocales.en={fileSingle:"file",filePlural:"files",browseLabel:"Browse &hellip;",removeLabel:"Remove",
removeTitle:"Clear selected files",cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",uploadLabel:"Upload",uploadTitle:"Upload selected files",msgNo:"No",msgNoFilesSelected:"No files selected",msgCancelled:"Cancelled",msgZoomModalHeading:"Detailed Preview",msgSizeTooSmall:'File "{name}" (<b>{size} KB</b>) is too small and must be larger than <b>{minSize} KB</b>.',msgSizeTooLarge:'File "{name}" (<b>{size} KB</b>) exceeds maximum allowed upload size of <b>{maxSize} KB</b>.',msgFilesTooLess:"You must select at least <b>{n}</b> {files} to upload.",
msgFilesTooMany:"Number of files selected for upload <b>({n})</b> exceeds maximum allowed limit of <b>{m}</b>.",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileName:'Invalid or unsupported characters in file name "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',
msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgUploadAborted:"The file upload was aborted",msgUploadThreshold:"Processing...",msgValidationError:"Validation Error",msgLoading:"Loading file {index} of {files} &hellip;",msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} {files} selected",msgFoldersNotAllowed:"Drag & drop files only! {n} folder(s) dropped were skipped.",msgImageWidthSmall:'Width of image file "{name}" must be at least {size} px.',
msgImageHeightSmall:'Height of image file "{name}" must be at least {size} px.',msgImageWidthLarge:'Width of image file "{name}" cannot exceed {size} px.',msgImageHeightLarge:'Height of image file "{name}" cannot exceed {size} px.',msgImageResizeError:"Could not get the image dimensions to resize.",msgImageResizeException:"Error while resizing the image.<pre>{errors}</pre>",dropZoneTitle:"Drag & drop files here &hellip;",dropZoneClickTitle:"<br>(or click to select {files})",previewZoomButtonTitles:{prev:"View previous file",
next:"View next file",toggleheader:"Toggle header",fullscreen:"Toggle full screen",borderless:"Toggle borderless mode",close:"Close detailed preview"}};f.fn.fileinput.Constructor=C;f(document).ready(function(){var a=f("input.file[type=file]");a.length&&a.fileinput()})});
